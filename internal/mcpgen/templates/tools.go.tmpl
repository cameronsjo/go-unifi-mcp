// Code generated by mcpgen. DO NOT EDIT.

package generated

import (
	"context"
	"encoding/json"

	"github.com/filipowm/go-unifi/unifi"
	"github.com/mark3labs/mcp-go/mcp"
	"github.com/mark3labs/mcp-go/server"
)

{{- range . }}
{{- $name := .Name }}
{{- $snake := .SnakeName }}
{{- $isSetting := .IsSetting }}

{{- if has "List" .Operations }}

// List{{ $name }} lists all {{ $name }} resources.
func List{{ $name }}(client unifi.Client) server.ToolHandlerFunc {
	return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
		site, _ := req.GetArguments()["site"].(string)
		if site == "" {
			site = "default"
		}

		result, err := client.List{{ $name }}(ctx, site)
		if err != nil {
			return mcp.NewToolResultError(err.Error()), nil
		}

		data, _ := json.MarshalIndent(result, "", "  ")
		return mcp.NewToolResultText(string(data)), nil
	}
}
{{- end }}

{{- if has "Get" .Operations }}

// Get{{ $name }} retrieves a {{ $name }} resource.
func Get{{ $name }}(client unifi.Client) server.ToolHandlerFunc {
	return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
		site, _ := req.GetArguments()["site"].(string)
		if site == "" {
			site = "default"
		}
		{{- if not $isSetting }}
		id, _ := req.GetArguments()["id"].(string)
		{{- end }}

		{{- if $isSetting }}
		result, err := client.Get{{ $name }}(ctx, site)
		{{- else }}
		result, err := client.Get{{ $name }}(ctx, site, id)
		{{- end }}
		if err != nil {
			return mcp.NewToolResultError(err.Error()), nil
		}

		data, _ := json.MarshalIndent(result, "", "  ")
		return mcp.NewToolResultText(string(data)), nil
	}
}
{{- end }}

{{- if has "Create" .Operations }}

// Create{{ $name }} creates a new {{ $name }} resource.
func Create{{ $name }}(client unifi.Client) server.ToolHandlerFunc {
	return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
		site, _ := req.GetArguments()["site"].(string)
		if site == "" {
			site = "default"
		}

		dataRaw, _ := json.Marshal(req.GetArguments()["data"])
		var input unifi.{{ $name }}
		if err := json.Unmarshal(dataRaw, &input); err != nil {
			return mcp.NewToolResultError("invalid data: " + err.Error()), nil
		}

		result, err := client.Create{{ $name }}(ctx, site, &input)
		if err != nil {
			return mcp.NewToolResultError(err.Error()), nil
		}

		data, _ := json.MarshalIndent(result, "", "  ")
		return mcp.NewToolResultText(string(data)), nil
	}
}
{{- end }}

{{- if has "Update" .Operations }}

// Update{{ $name }} updates a {{ $name }} resource.
func Update{{ $name }}(client unifi.Client) server.ToolHandlerFunc {
	return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
		site, _ := req.GetArguments()["site"].(string)
		if site == "" {
			site = "default"
		}

		dataRaw, _ := json.Marshal(req.GetArguments()["data"])
		var input unifi.{{ $name }}
		if err := json.Unmarshal(dataRaw, &input); err != nil {
			return mcp.NewToolResultError("invalid data: " + err.Error()), nil
		}

		result, err := client.Update{{ $name }}(ctx, site, &input)
		if err != nil {
			return mcp.NewToolResultError(err.Error()), nil
		}

		data, _ := json.MarshalIndent(result, "", "  ")
		return mcp.NewToolResultText(string(data)), nil
	}
}
{{- end }}

{{- if has "Delete" .Operations }}

// Delete{{ $name }} deletes a {{ $name }} resource.
func Delete{{ $name }}(client unifi.Client) server.ToolHandlerFunc {
	return func(ctx context.Context, req mcp.CallToolRequest) (*mcp.CallToolResult, error) {
		site, _ := req.GetArguments()["site"].(string)
		if site == "" {
			site = "default"
		}
		id, _ := req.GetArguments()["id"].(string)

		err := client.Delete{{ $name }}(ctx, site, id)
		if err != nil {
			return mcp.NewToolResultError(err.Error()), nil
		}

		return mcp.NewToolResultText(`{"success": true}`), nil
	}
}
{{- end }}
{{- end }}
